{% extends "layout.html" %}

{% block title %}Profile - Crabcakes Admin{% endblock %}

{% block content %}
<h1>User Profile</h1>
<p class="subtitle">Your account information and temporary credentials</p>

<div class="info-section">
    <div class="info-row">
        <span class="info-label">Status:</span>
        <span class="status">Authenticated</span>
    </div>
    <div class="info-row">
        <span class="info-label">Email:</span>
        <span class="info-value">{{ user_email }}</span>
    </div>
    <div class="info-row">
        <span class="info-label">User ID:</span>
        <span class="info-value">{{ user_id }}</span>
    </div>
    <div class="info-row">
        <span class="info-label">Access Key:</span>
        <span class="info-value">{{ access_key_id }}</span>
    </div>
    <div class="info-row">
        <span class="info-label">Secret Key:</span>
        <span class="info-value">{{ secret_key_preview }}...</span>
    </div>
    <div class="info-row">
        <span class="info-label">Expires:</span>
        <span class="info-value">{{ expires_at }}</span>
    </div>
</div>

<div style="color: #666; font-size: 14px; margin-top: 20px;">
    <p>Your temporary AWS credentials have been stored in your browser's localStorage for use with S3 operations.</p>
</div>
{% endblock %}

{% block extra_scripts %}
// Fetch full credentials from API and store in localStorage
fetch('/api/session')
    .then(response => {
        if (!response.ok) {
            throw new Error('Failed to fetch credentials');
        }
        return response.json();
    })
    .then(data => {
        // Store credentials in localStorage
        localStorage.setItem('crabcakes_access_key_id', data.access_key_id);
        localStorage.setItem('crabcakes_secret_access_key', data.secret_access_key);
        localStorage.setItem('crabcakes_expires_at', data.expires_at);
        localStorage.setItem('crabcakes_user_email', data.user_email);
        console.log('Credentials stored in localStorage');
    })
    .catch(error => {
        console.error('Error fetching credentials:', error);
    });
{% endblock %}
