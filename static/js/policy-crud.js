function b(o,c,i,t,e,n,a){try{var s=o[n](a),u=s.value}catch(r){i(r);return}s.done?c(u):Promise.resolve(u).then(t,e)}function g(o){return function(){var c=this,i=arguments;return new Promise(function(t,e){var n=o.apply(c,i);function a(u){b(n,t,e,a,s,"next",u)}function s(u){b(n,t,e,a,s,"throw",u)}a(void 0)})}}function P(o,c,i){return c in o?Object.defineProperty(o,c,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[c]=i,o}function m(o){for(var c=1;c<arguments.length;c++){var i=arguments[c]!=null?arguments[c]:{},t=Object.keys(i);typeof Object.getOwnPropertySymbols=="function"&&(t=t.concat(Object.getOwnPropertySymbols(i).filter(function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable}))),t.forEach(function(e){P(o,e,i[e])})}return o}function S(o,c){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(o);c&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable})),i.push.apply(i,t)}return i}function p(o,c){return c=c??{},Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(c)):S(Object(c)).forEach(function(i){Object.defineProperty(o,i,Object.getOwnPropertyDescriptor(c,i))}),o}function k(o){"@swc/helpers - typeof";return o&&typeof Symbol<"u"&&o.constructor===Symbol?"symbol":typeof o}function w(o,c){var i,t,e,n={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},a=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(r){return function(l){return u([r,l])}}function u(r){if(i)throw new TypeError("Generator is already executing.");for(;a&&(a=0,r[0]&&(n=0)),n;)try{if(i=1,t&&(e=r[0]&2?t.return:r[0]?t.throw||((e=t.return)&&e.call(t),0):t.next)&&!(e=e.call(t,r[1])).done)return e;switch(t=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return n.label++,{value:r[1],done:!1};case 5:n.label++,t=r[1],r=[0];continue;case 7:r=n.ops.pop(),n.trys.pop();continue;default:if(e=n.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){n=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){n.label=r[1];break}if(r[0]===6&&n.label<e[1]){n.label=e[1],e=r;break}if(e&&n.label<e[2]){n.label=e[2],n.ops.push(r);break}e[2]&&n.ops.pop(),n.trys.pop();continue}r=c.call(o,n)}catch(l){r=[6,l],t=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}}var f=null;function j(){return g(function(){var o,c,i;return w(this,function(t){switch(t.label){case 0:if(f)return[2,f];t.label=1;case 1:return t.trys.push([1,4,,5]),[4,fetch("/admin/api/csrf-token")];case 2:if(o=t.sent(),!o.ok)throw new Error("Failed to fetch CSRF token");return[4,o.json()];case 3:return c=t.sent(),f=c.csrf_token,[2,f];case 4:throw i=t.sent(),console.error("Error fetching CSRF token:",i),i;case 5:return[2]}})})()}function y(o){return g(function(c){var i,t,e,n=arguments;return w(this,function(a){switch(a.label){case 0:return i=n.length>1&&n[1]!==void 0?n[1]:{},[4,j()];case 1:return t=a.sent(),e=p(m({},i.headers),{"X-CSRF-Token":t}),i.body&&k(i.body)==="object"&&(e["Content-Type"]="application/json",i.body=JSON.stringify(i.body)),[2,fetch(c,p(m({},i),{headers:e}))]}})}).apply(this,arguments)}function v(o,c,i,t,e,n,a){try{var s=o[n](a),u=s.value}catch(r){i(r);return}s.done?c(u):Promise.resolve(u).then(t,e)}function d(o){return function(){var c=this,i=arguments;return new Promise(function(t,e){var n=o.apply(c,i);function a(u){v(n,t,e,a,s,"next",u)}function s(u){v(n,t,e,a,s,"throw",u)}a(void 0)})}}function E(o,c){return c!=null&&typeof Symbol<"u"&&c[Symbol.hasInstance]?!!c[Symbol.hasInstance](o):o instanceof c}function h(o,c){var i,t,e,n={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},a=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(r){return function(l){return u([r,l])}}function u(r){if(i)throw new TypeError("Generator is already executing.");for(;a&&(a=0,r[0]&&(n=0)),n;)try{if(i=1,t&&(e=r[0]&2?t.return:r[0]?t.throw||((e=t.return)&&e.call(t),0):t.next)&&!(e=e.call(t,r[1])).done)return e;switch(t=0,e&&(r=[r[0]&2,e.value]),r[0]){case 0:case 1:e=r;break;case 4:return n.label++,{value:r[1],done:!1};case 5:n.label++,t=r[1],r=[0];continue;case 7:r=n.ops.pop(),n.trys.pop();continue;default:if(e=n.trys,!(e=e.length>0&&e[e.length-1])&&(r[0]===6||r[0]===2)){n=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){n.label=r[1];break}if(r[0]===6&&n.label<e[1]){n.label=e[1],e=r;break}if(e&&n.label<e[2]){n.label=e[2],n.ops.push(r);break}e[2]&&n.ops.pop(),n.trys.pop();continue}r=c.call(o,n)}catch(l){r=[6,l],t=0}finally{i=e=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}}function x(o){return d(function(){var c,i,t,e;return h(this,function(n){switch(n.label){case 0:if(!confirm('Are you sure you want to delete policy "'.concat(o,'"?')))return[2];n.label=1;case 1:return n.trys.push([1,5,,6]),[4,y("/admin/api/policies/".concat(o),{method:"DELETE"})];case 2:return c=n.sent(),c.ok?[3,4]:[4,c.text()];case 3:throw i=n.sent(),new Error("Failed to delete policy: ".concat(i));case 4:return window.location.href="/admin/policies",[3,6];case 5:return t=n.sent(),console.error("Error deleting policy:",t),e=E(t,Error)?t.message:String(t),alert("Error deleting policy: ".concat(e)),[3,6];case 6:return[2]}})})()}function I(o,c){return d(function(){var i,t,e,n,a,s,u,r;return h(this,function(l){switch(l.label){case 0:return l.trys.push([0,5,,6]),i=o&&o!=="",t=i?"/admin/api/policies/".concat(o):"/admin/api/policies",e=i?"PUT":"POST",n=i?c:{name:o,policy:c},[4,y(t,{method:e,body:n})];case 1:return a=l.sent(),a.ok?[3,3]:[4,a.json()];case 2:throw s=l.sent(),new Error("Failed to save policy: ".concat(s.error));case 3:return[4,a.json()];case 4:return u=l.sent(),[2,u];case 5:throw r=l.sent(),console.error("Error saving policy:",r),r;case 6:return[2]}})})()}function C(){var o=document.getElementById("policy-form");o&&o.addEventListener("submit",function(c){return d(function(){var i,t,e,n,a,s,u,r;return h(this,function(l){switch(l.label){case 0:c.preventDefault(),i=document.getElementById("policy-name"),t=document.getElementById("policy-json"),e=encodeURIComponent(i.value),n=t.value,l.label=1;case 1:return l.trys.push([1,3,,4]),a=JSON.parse(n),[4,I(e,a)];case 2:return l.sent(),window.location.href="/admin/policies/".concat(e),[3,4];case 3:if(s=l.sent(),u=E(s,Error)?s.message:String(s),r=document.getElementById("error-notification"),r){for(r.textContent=u;r.classList.contains("error-notification-hide");)r.classList.remove("error-notification-hide");r.classList.remove("error-notification-empty")}else console.error("Error notification element not found");return[3,4];case 4:return[2]}})})()})}function _(){var o=document.getElementById("delete-policy-btn");o&&o.addEventListener("click",function(c){c.preventDefault();var i=o.dataset.policyName;i&&x(i)})}function O(){var o=document.getElementsByClassName("error-notification");Array.from(o).forEach(function(c){console.debug(c.textContent.trim().length),c.textContent.trim().length==0?(console.debug("empty"),c.classList.add("error-notification-hide")):c.classList.remove("error-notification-hide")}),C(),_(),console.debug("Finished startup")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",O):O();
